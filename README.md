# Сайт по генерации контента статьи #

## Деплой проекта ##

В файле /etc/hosts добавить запись 127.0.0.1 blablaarticle.

Собрать проект командой:

```shell
docker-compose build
```

Запустить проект командой:
```shell
docker-compose up -d
```
Установить зависимости проекта:

```shell
docker-compose run --rm php-8.0 composer install
```

Произвести установку зависимостей yarn командой:
```shell
docker-compose run --rm node yarn install
```

Сделать сборку скриптов и стилей проекта. Для этого можно использовать одну из ниже указанных команд:
```shell
docker-compose run --rm node yarn dev
```
либо
```shell
docker-compose run --rm node yarn watch
```

Создать базу данных:
```shell
docker-compose run --rm php-8.0 php bin/console doctrine:database:create
```

Загрузить миграции:
```shell
docker-compose run --rm php-8.0 php bin/console doctrine:migrations:migrate
```

Загрузить фикстуры:
```shell
docker-compose run --rm php-8.0 php bin/console doctrine:fixtures:load
```

Затем перейти на blablaarticle:8080

## Регистрация ##

Регистрация выполнена через форму. Чтобы зарегистрироваться, необходимо ввести 
имя, email, пароль и подтвердить его. После заполнения формы на электронную почту 
придет ссылка. Для завершения регистрации необходимо подтвердить email, перейдя 
по этой ссылке.

По умолчанию новому пользователю присваивается подписка FREE. Так же происходит генерация 
API тоекна.

## Авторизация

Происходит через форму по паролю и электронной почте. Так же осуществляется проверка 
подтверждения почты пользователем. Так же существует авторизация по API токену для доступа 
к функционалу генерации статей по API.

Все административные разделы доступны лишь пользователям с подтвержденной почтой. Для 
проверки используется класс Voter, он действует на все методы контроллеров административного 
раздела.

## Профиль

Профиль пользователя доступен только подтвердившим свою почту пользователям. На странице
есть форма для изменения пользовательской информации. Так же есть форма для генерации нового 
токена. Запрос на обновление токена отправляется посредством ajax, далее javascript отображает
сообщени об успешном обновлении, либо производит вывод сообщения об ошибке.

## Подписки

Подписки храняться в БД в таблице subscription. В таблице хранятся названия подписок,
их стоимость в долларах и опции. Информация о сроке истечения подписки пользователя хранится
в поле expire_at таблицы user. При истечении срока подписки она понижается на
уровень FREE. За понижение подписки отвечает консольная команда
DowngradeExpiredSubscriptionCommand.php, которую cron должен запускать ежедневно.

## Модули для генерации статей

[//]: # ( ToDO: Добавить информацию о модулях по итогу реализации их функционала)

## Генерация статей ##

### Общее описание процесса ###

Генерация статей базируется на паттерне Стратегия. Существует класс контекста - ArticleGenerator,
который может генерировать статьи в соответствии с переданной стратегией и объектом модели формы.
Результат генерации - строка, содержащая весь контент статьи (html-разметку, текст статьи и пр.). 
Работа генерации в зависимости от переданной стратегии описана ниже.

### Демонстрационная генерация статьи ###

Реализована классом стратегии DemoArticleGenerationStrategy. Класс DTO для реализации содержит
продвигаемое слово и заголовок статьи, прочие параметры заданы по умолчанию. 
Генерация статей для демонстрации доступна любому неавторизованному пользователю.
Сгенерировать статью можно только один раз, после этого id этой статьи записывается в cookie
и форма блокируется.
